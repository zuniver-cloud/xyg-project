# 接口文档

## 📋 **概述**

本文档描述了模板管理和ER模型生成功能的相关接口，包含请求报文和响应报文的详细说明。

---

## 🎯 **模板管理功能接口**

### **1. 获取模板列表**

#### **接口信息**
- **URL**: `/api/templates/query`
- **方法**: `GET`
- **描述**: 获取模板列表，支持分页和搜索

#### **请求参数**
```javascript
{
  "page": 1,           // 页码，默认1
  "size": 10,     // 每页数量，默认10
  "keyword": "",       // 搜索关键词，可选
  "template_sort": "",    // 模板分类，可选
  "publisher":""//发布人
}
```
请根据以下电商业务需求，完成相关任务：业务模块：{业务模块}功能描述：{功能描述}输入条件：{输入条件}处理逻辑：{处理逻辑}输出结果：{输出结果}注意事项：{注意事项}
#### **期望响应**
```javascript
{
  "code": 00,
  "message": "success",
  "data": {
    "page": 1,
    "size": 10,
    "total": 23,
    "total_pages": 3,
    "templates": [
      {
        "template_id": 101,
        "template_name": "ER表设计模板",
        "context": "该模板用于ER设计",
        "json_text": {
          "raw_text": "请设计一张 {表名} 表，包含字段 {字段集合}。",
          "variables": [
            { "name": "表名", "desc": "数据库表的名称" ,"value":"null"},
            { "name": "字段集合", "desc": "字段及数据类型说明","value":"null" }
          ]
        },
        "publisher": "admin",
        "published_at": "2025-08-20 10:12:30",
        "last_modified": "2025-08-20 11:45:10"
      },
      {
        "template_id": 102,
        "template_name": "接口设计模板",
        "context": "用于接口设计模板",
        "json_text": {
          "raw_text": "请设计接口 {接口名}，输入参数 {输入集合}，输出参数 {输出集合}。",
          "variables": [
            { "name": "接口名", "desc": "接口的名称" },
            { "name": "输入集合", "desc": "输入参数及说明" },
            { "name": "输出集合", "desc": "输出参数及说明" }
          ]
        },
        "publisher": "admin",
        "published_at": "2025-08-19 09:00:00",
        "last_modified": "2025-08-19 10:15:22"
      }
    ]
  }
}

```

### **2. 获取模板详情**

#### **接口信息**
- **URL**: `/api/templates/{template_id}`
- **方法**: `GET`
- **描述**: 获取指定模板的详细信息

#### **请求参数**
```javascript
// 路径参数
{
  "template_id": 1  // 模板ID
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "查询成功",
  "data": {
    "template_id": 1,
    "template_name": "电商系统模板",
    "context": "适用于电商平台的数据库设计模板",
    "template_sort": "电商",
    "json_text": {
          "raw_text": "请设计一张 {表名} 表，包含字段 {字段集合}。",
          "variables": [
            { "name": "表名", "desc": "数据库表的名称" },
            { "name": "字段集合", "desc": "字段及数据类型说明" }
          ]
        },
        "publisher": "admin",
        "published_at": "2025-08-20 10:12:30",
        "last_modified": "2025-08-20 11:45:10"
      }
  }

```

### **3. 创建模板**

#### **接口信息**
- **URL**: `/api/templates`
- **方法**: `POST`
- **描述**: 创建新的模板

#### **请求报文**
```javascript
{
  "template_name": "数据库表设计",
  "context": "ER图设计模板（修改版）",
  "json_text": {
    "raw_text": "请设计一张 {表名} 表，字段为 {字段集合}，并且添加备注 {备注}。",
    "variables": [
      { "name": "表名", "desc": "数据库表的名称" },
      { "name": "字段集合", "desc": "字段及数据类型说明" },
      { "name": "备注", "desc": "额外的说明信息" }
    ]
  },
  "publisher": "editor"
}

```

#### **期望响应**
```javascript
{
  "code": 00,
  "message": "模板录入成功",
  "data": {
    "template_id": 101,
    "template_name":"数据库表设计"
  }
}

```

### **4. 更新模板**

#### **接口信息**
- **URL**: `/api/templates/{template_id}`
- **方法**: `PUT`
- **描述**: 更新指定模板

#### **请求报文**
```javascript
{
  "template_id": 101,
  "context": "ER图设计模板（修改版）",
  "json_text": {
    "raw_text": "请设计一张 {表名} 表，字段为 {字段集合}，并且添加备注 {备注}。",
    "variables": [
      { "name": "表名", "desc": "数据库表的名称" },
      { "name": "字段集合", "desc": "字段及数据类型说明" },
      { "name": "备注", "desc": "额外的说明信息" }
    ]
  },
  "publisher": "editor"
}

```

#### **期望响应**
```javascript
{
  "code": 00,
  "message": "模板更新成功",
  "data": {
    "template_id": 101,
    "context": "ER图设计模板（修改版）",
    "json_text": {
      "raw_text": "请设计一张 {表名} 表，字段为 {字段集合}，并且添加备注 {备注}。",
      "variables": [
        { "name": "表名", "desc": "数据库表的名称" },
        { "name": "字段集合", "desc": "字段及数据类型说明" },
        { "name": "备注", "desc": "额外的说明信息" }
      ]
    },
    "publisher": "editor",
    "published_at": "2025-08-20 14:10:00",
    "last_modified": "2025-08-20 15:30:00"
  }
}

```

### **5. 删除模板**

#### **接口信息**
- **URL**: `/api/templates/{template_id}`
- **方法**: `DELETE`
- **描述**: 删除指定模板

#### **请求参数**
```javascript
// 路径参数
{
  "template_id": 3  // 模板ID
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "删除成功",
  "data": null
}
```

---

## 🏗️ **ER模型生成功能接口**

### **1. 获取需求列表**

#### **接口信息**
- **URL**: `/api/requirements`
- **方法**: `GET`
- **描述**: 获取需求列表，用于ER模型生成

#### **请求参数**
```javascript
{
  "userId":01         //用户id
  "pageNum": 1,           // 页码，默认1
  "pageSize": 10,     // 每页数量，默认10
  "keyword": "",       // 搜索关键词，可选
  "status": "active"   // 需求状态，可选值：active/inactive
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "查询成功",
  "data": {
    "total": 30,
    "page": 1,
    "page_size": 10,
    "requirements": [
      {
        "requirement_id": 1,
        "user_id":2001,
        "requirement_name": "会员订单管理系统需求",
        "requirement": "需要一个会员订单管理系统，包含会员管理、订单管理、商品管理等功能",
        "context": "我们公司需要开发一个会员订单管理系统，主要功能包括：1. 会员注册、登录、信息管理；2. 商品展示、搜索、购买；3. 订单创建、支付、跟踪；4. 会员等级、积分管理",
        "json_text": {
        "raw_text": "请设计一张 {表名} 表，字段为 {字段集合}",
        "variables": [
        { "name": "表名", "desc": "数据库表的名称", "value":"商品"  }, 
        { "name": "字段集合", "desc": "字段及数据类型说明", "value": "价格" } 
      ],
      "status":"active",
      "created_at":"2025-08-20 17:00:00",
      "updated_at":"2025-8-20 17:00:00"
    }
      }
    ]
  }
}
```

### **2. 生成ER模型**

#### **接口信息**
- **URL**: `/api/er/generate`
- **方法**: `POST`
- **描述**: 根据需求生成ER模型

#### **请求报文**
```javascript
{
  "template_id": 1,  // 可选，使用的模板ID
  "userId":"1000003",
  "requirement":["1","2"],//这个意思就是说提取出来 "raw_text": "请设计一张 {商品} 表，字段为 {价格，种类}，并且添加备注{备注}中的变量，把变量值就是desc拼成一个字符数组，传给后端，后端就接收到的是模板id去找模板，并通过这个字符数组去拼成一个完整的描述，这个是后端去处理的逻辑，我只是给你说为什么传递这几个参数。
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "生成成功",
  "data": {
    "erId": "temp_12345",
    "erName": "111",
    "description": "基于需求'会员订单管理系统需求'生成的数据库设计",
    "entities": [
      {
        "name": "会员",
        "attribute": [
          {
            "name": "会员ID",
            "type": "PK"
          },
          {
            "name": "用户名",
            "type": "varchar(50)"
          },
          {
            "name": "邮箱",
            "type": "varchar(100)"
          },
          {
            "name": "密码哈希",
            "type": "varchar(255)"
          },
          {
            "name": "手机号",
            "type": "varchar(20)"
          },
          {
            "name": "会员等级",
            "type": "enum('普通会员','银卡会员','金卡会员')"
          },
          {
            "name": "积分余额",
            "type": "int"
          },
          {
            "name": "注册时间",
            "type": "datetime"
          },
          {
            "name": "最后登录时间",
            "type": "datetime"
          },
          {
            "name": "状态",
            "type": "enum('active','inactive','banned')"
          }
        ]
      },
      {
        "name": "商品",
        "attribute": [
          {
            "name": "商品ID",
            "type": "PK"
          },
          {
            "name": "商品名称",
            "type": "varchar(200)"
          },
          {
            "name": "商品描述",
            "type": "text"
          },
          {
            "name": "价格",
            "type": "decimal(10,2)"
          },
          {
            "name": "库存数量",
            "type": "int"
          },
          {
            "name": "商品状态",
            "type": "enum('on_sale','off_sale','deleted')"
          },
          {
            "name": "创建时间",
            "type": "datetime"
          },
          {
            "name": "更新时间",
            "type": "datetime"
          }
        ]
      },
      {
        "name": "订单",
        "attribute": [
          {
            "name": "订单ID",
            "type": "PK"
          },
          {
            "name": "会员ID",
            "type": "FK"
          },
          {
            "name": "订单号",
            "type": "varchar(50)"
          },
          {
            "name": "订单状态",
            "type": "enum('待支付','已支付','已发货','已完成')"
          },
          {
            "name": "订单金额",
            "type": "decimal(10,2)"
          },
          {
            "name": "支付方式",
            "type": "enum('支付宝','微信支付','银行卡')"
          },
          {
            "name": "支付时间",
            "type": "datetime"
          },
          {
            "name": "创建时间",
            "type": "datetime"
          },
          {
            "name": "更新时间",
            "type": "datetime"
          }
        ]
      },
      {
        "name": "订单详情",
        "attribute": [
          {
            "name": "详情ID",
            "type": "PK"
          },
          {
            "name": "订单ID",
            "type": "FK"
          },
          {
            "name": "商品ID",
            "type": "FK"
          },
          {
            "name": "商品名称",
            "type": "varchar(200)"
          },
          {
            "name": "商品单价",
            "type": "decimal(10,2)"
          },
          {
            "name": "购买数量",
            "type": "int"
          },
          {
            "name": "小计金额",
            "type": "decimal(10,2)"
          }
        ]
      }
    ],
    "relationship": [
      {
        "name": "创建订单",
        "from": "会员",
        "to": "订单",
        "type": "one-to-many"
      },
      {
        "name": "包含商品",
        "from": "订单",
        "to": "订单详情",
        "type": "one-to-many"
      },
      {
        "name": "关联商品",
        "from": "订单详情",
        "to": "商品",
        "type": "many-to-one"
      }
    ],
    "created_at": "2025-01-20 16:00:00"
  }
}
```

### **3. 获取ER模型列表**

#### **接口信息**
- **URL**: `/api/er/query`
- **方法**: `POST`
- **描述**: 获取ER模型列表

#### **请求参数**
```javascript
{
  "pageNum": 1,           // 页码，默认1
  "pageSize": 10,     // 每页数量，默认10
  "startTime":"2025-8-01",
  "endTime":"",
  "requirement_id": "", // 需求ID，可选
  "userId": ""        // 用户ID，可选
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "查询成功",
  "data": {
   "record":[
    {
      "erId":10,                       //非常关键，要通过erid去查er模型的详细信息
      "erName":"图书管理系统",
      "description":"示例模型",
      "updateAt":"2025-08-15"
    },
    ......
   ],
   "total":25,
   "pageNum":1,
   "pageSize":10
  }
}


```

### **4. 创建ER模型**

#### **接口信息**
- **URL**: `/api/er/edit`
- **方法**: `PUT`
- **描述**: 修改ER模型到仓库

#### **请求报文**
```javascript
{
  "code": 00,
  "msg": "生成成功",
  "data": {
    "erId": "temp_12345",
    "erName": "111",
    "userID":"1000000",
    "description": "基于需求'会员订单管理系统需求'生成的数据库设计",
    "erJson":{
    "entities": [
      {
        "name": "member",
        "attribute": [
          {
            "字段英文名": "memberid",
            "字段中文名": "会员id"
          },
          {
            "字段英文名": "grade",
            "字段中文名": "等级"
          }
        ]
      },
      {
        "name": "order",
        "attribute": [
          {
            "字段英文名": "orderID",
            "字段中文名": "订单ID"
          },
          {
            "字段英文名": "orderNumber",
            "字段中文名": "订单号"
          },
          {
            "字段英文名": "createTime",
            "字段中文名": "创建时间"
          },
          {
            "字段英文名": "updateTime",
            "字段中文名": "修改时间"
          }
        ]
      }],
    "relationship": [
      {
        "name": "创建",
        "from": "member",
        "to": "订单",
        "type": "1:N"
      }
    ]
    },
  }
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "操作成功",
}
```

### **5. 更新ER模型**//可以复用接口4


### **6. 删除ER模型**

#### **接口信息**
- **URL**: `/api/er/{erId}?userId=xxx`
- **方法**: `DELETE`
- **描述**: 删除ER模型

#### **请求参数**
```javascript
// 路径参数
{
  "erId": 2 , // ER模型ID
  "userId":"100000003",//每个用户都有一个er模型仓库
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "删除成功",

}
```


### **7. 查询某个ER模型详情**

#### **接口信息**
- **URL**: `/api/er/{erId}?userId=xxx`
- **方法**: `GET`
- **描述**: 查询某一个ER模型详情

#### **请求参数**
```javascript
// 路径参数
{
  "erId": 2,
  "userId":"100000"  // 用户id
}
```

#### **期望响应**
```javascript
{
  "code": 00,
  "msg": "生成成功",
  "data": {
    "erId": "temp_12345",
    "erName": "111",
    "description": "基于需求'会员订单管理系统需求'生成的数据库设计",
    "erJson":{
    "entities": [
      {
        "name": "会员",
        "attribute": [
          {
            "name": "会员ID",
            "type": "PK"
          },
          {
            "name": "用户名",
            "type": "varchar(50)"
          },
          {
            "name": "邮箱",
            "type": "varchar(100)"
          },
          {
            "name": "密码哈希",
            "type": "varchar(255)"
          },
          {
            "name": "手机号",
            "type": "varchar(20)"
          },
          {
            "name": "会员等级",
            "type": "enum('普通会员','银卡会员','金卡会员')"
          },
          {
            "name": "积分余额",
            "type": "int"
          },
          {
            "name": "注册时间",
            "type": "datetime"
          },
          {
            "name": "最后登录时间",
            "type": "datetime"
          },
          {
            "name": "状态",
            "type": "enum('active','inactive','banned')"
          }
        ]
      },
      {
        "name": "商品",
        "attribute": [
          {
            "name": "商品ID",
            "type": "PK"
          },
          {
            "name": "商品名称",
            "type": "varchar(200)"
          },
          {
            "name": "商品描述",
            "type": "text"
          },
          {
            "name": "价格",
            "type": "decimal(10,2)"
          },
          {
            "name": "库存数量",
            "type": "int"
          },
          {
            "name": "商品状态",
            "type": "enum('on_sale','off_sale','deleted')"
          },
          {
            "name": "创建时间",
            "type": "datetime"
          },
          {
            "name": "更新时间",
            "type": "datetime"
          }
        ]
      },
      {
        "name": "订单",
        "attribute": [
          {
            "name": "订单ID",
            "type": "PK"
          },
          {
            "name": "会员ID",
            "type": "FK"
          },
          {
            "name": "订单号",
            "type": "varchar(50)"
          },
          {
            "name": "订单状态",
            "type": "enum('待支付','已支付','已发货','已完成')"
          },
          {
            "name": "订单金额",
            "type": "decimal(10,2)"
          },
          {
            "name": "支付方式",
            "type": "enum('支付宝','微信支付','银行卡')"
          },
          {
            "name": "支付时间",
            "type": "datetime"
          },
          {
            "name": "创建时间",
            "type": "datetime"
          },
          {
            "name": "更新时间",
            "type": "datetime"
          }
        ]
      },
      {
        "name": "订单详情",
        "attribute": [
          {
            "name": "详情ID",
            "type": "PK"
          },
          {
            "name": "订单ID",
            "type": "FK"
          },
          {
            "name": "商品ID",
            "type": "FK"
          },
          {
            "name": "商品名称",
            "type": "varchar(200)"
          },
          {
            "name": "商品单价",
            "type": "decimal(10,2)"
          },
          {
            "name": "购买数量",
            "type": "int"
          },
          {
            "name": "小计金额",
            "type": "decimal(10,2)"
          }
        ]
      }
    ],
    "relationship": [
      {
        "name": "创建订单",
        "from": "会员",
        "to": "订单",
        "type": "one-to-many"
      },
      {
        "name": "包含商品",
        "from": "订单",
        "to": "订单详情",
        "type": "one-to-many"
      },
      {
        "name": "关联商品",
        "from": "订单详情",
        "to": "商品",
        "type": "many-to-one"
      }
    ]
    },
    "updateAt": "2025-01-20 16:00:00"
  }
}
```

