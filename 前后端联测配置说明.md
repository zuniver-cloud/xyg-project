# å‰åç«¯è”æµ‹é…ç½®è¯´æ˜

## ğŸ“‹ é…ç½®æ­¥éª¤

### 1. é…ç½®APIåœ°å€
**æ–‡ä»¶ä½ç½®**: `src/config/index.js`

```javascript
// å¼€å‘ç¯å¢ƒ
development: {
  // å°†æ­¤å¤„æ”¹ä¸ºçœŸå®çš„åç«¯APIåœ°å€
  apiBaseUrl: 'http://localhost:8080', // ç¤ºä¾‹ï¼šåç«¯è¿è¡Œåœ¨8080ç«¯å£
  appTitle: 'æ™ºèƒ½è®¾è®¡åŠ©æ‰‹'
}
```

### 2. å¯ç”¨ä»£ç†é…ç½®
**æ–‡ä»¶ä½ç½®**: `vite.config.js`

```javascript
server: {
  port: 5173,
  strictPort: true,
  // å–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç†é…ç½®
  proxy: {
    '/api': {
      target: 'http://localhost:8080', // åç«¯APIåœ°å€
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '')
    }
  }
}
```

### 3. æ¢å¤TokenéªŒè¯
**æ–‡ä»¶ä½ç½®**: `src/utils/request.js`

```javascript
// è¯·æ±‚æ‹¦æˆªå™¨ - å–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç 
const userStore = useUserStore()
if (userStore.token) {
  config.headers['Authorization'] = `Bearer ${userStore.token}`
}

// å“åº”æ‹¦æˆªå™¨ - åˆ é™¤æ¨¡æ‹Ÿå“åº”ä»£ç 
// åˆ é™¤ä»¥ä¸‹ä»£ç å—ï¼š
// if (error.code === 'ERR_NETWORK' || error.message.includes('Network Error')) {
//   console.log('å‰ç«¯æµ‹è¯•æ¨¡å¼ï¼šæ¨¡æ‹ŸAPIå“åº”')
//   return Promise.resolve({...})
// }

// 401é”™è¯¯å¤„ç† - å–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç 
ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
const userStore = useUserStore()
userStore.logout()
window.location.href = '/login'
```

### 4. æ¢å¤è·¯ç”±å®ˆå«
**æ–‡ä»¶ä½ç½®**: `src/router/index.js`

```javascript
// å–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç 
const token = localStorage.getItem('token')
const userRole = localStorage.getItem('userRole')

// åˆ é™¤æµ‹è¯•é˜¶æ®µçš„é»˜è®¤å€¼
// const token = localStorage.getItem('token') || 'test-token'
// const userRole = localStorage.getItem('userRole') || 'admin'

// å–æ¶ˆæ³¨é‡Štokenæ£€æŸ¥ä»£ç 
if (!token) {
  console.log('æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ')
  next('/login')
  return
}
```

### 5. æ¢å¤çœŸå®ç™»å½•
**æ–‡ä»¶ä½ç½®**: `src/stores/user.js`

```javascript
// å–æ¶ˆæ³¨é‡ŠçœŸå®APIè°ƒç”¨ä»£ç 
const response = await loginApi(credentials)
token.value = response.token
localStorage.setItem('token', response.token)

// åˆ é™¤æ¨¡æ‹Ÿç™»å½•ä»£ç 
// const mockResponse = {...}

// å–æ¶ˆæ³¨é‡ŠçœŸå®ç”¨æˆ·ä¿¡æ¯è·å–
await fetchUserInfo()

// åˆ é™¤æ¨¡æ‹Ÿç”¨æˆ·ä¿¡æ¯ä»£ç 
// userInfo.value = mockResponse.userInfo
// permissions.value = mockResponse.userInfo.role === 'admin' ? ['admin'] : ['user']
```

## ğŸ”§ éªŒè¯æ­¥éª¤

1. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   # ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨é…ç½®çš„ç«¯å£ä¸Š
   # ä¾‹å¦‚ï¼šhttp://localhost:8080
   ```

2. **å¯åŠ¨å‰ç«¯æœåŠ¡**
   ```bash
   npm run dev
   ```

3. **æµ‹è¯•ç™»å½•åŠŸèƒ½**
   - è®¿é—® `http://localhost:5173/login`
   - ä½¿ç”¨çœŸå®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•
   - éªŒè¯tokenæ˜¯å¦æ­£ç¡®ä¿å­˜

4. **æµ‹è¯•APIè¯·æ±‚**
   - æ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networké¢æ¿
   - ç¡®è®¤APIè¯·æ±‚å‘é€åˆ°æ­£ç¡®çš„åç«¯åœ°å€
   - éªŒè¯å“åº”æ•°æ®æ ¼å¼

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **CORSé…ç½®**: ç¡®ä¿åç«¯å·²æ­£ç¡®é…ç½®CORSï¼Œå…è®¸å‰ç«¯åŸŸåè®¿é—®
2. **APIæ ¼å¼**: ç¡®ä¿åç«¯APIè¿”å›æ ¼å¼ä¸å‰ç«¯æœŸæœ›ä¸€è‡´
3. **Tokenæ ¼å¼**: ç¡®è®¤åç«¯è¿”å›çš„tokenæ ¼å¼ä¸å‰ç«¯å¤„ç†é€»è¾‘åŒ¹é…
4. **é”™è¯¯å¤„ç†**: æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µï¼ˆç½‘ç»œé”™è¯¯ã€è®¤è¯å¤±è´¥ç­‰ï¼‰

## ğŸš€ å¿«é€Ÿåˆ‡æ¢

å¦‚æœéœ€è¦å¿«é€Ÿåˆ‡æ¢å›å‰ç«¯æµ‹è¯•æ¨¡å¼ï¼š

1. åœ¨ `src/config/index.js` ä¸­å°† `apiBaseUrl` è®¾ä¸ºç©ºå­—ç¬¦ä¸²
2. åœ¨ `vite.config.js` ä¸­æ³¨é‡Šæ‰ä»£ç†é…ç½®
3. åœ¨ `src/utils/request.js` ä¸­æ¢å¤æ¨¡æ‹Ÿå“åº”ä»£ç 
4. åœ¨ `src/stores/user.js` ä¸­æ¢å¤æ¨¡æ‹Ÿç™»å½•ä»£ç 
5. åœ¨ `src/router/index.js` ä¸­æ¢å¤æµ‹è¯•é˜¶æ®µçš„é»˜è®¤å€¼

## ğŸ“ å¸¸è§é—®é¢˜

**Q: å‰ç«¯è¯·æ±‚æŠ¥CORSé”™è¯¯**
A: æ£€æŸ¥åç«¯CORSé…ç½®ï¼Œæˆ–ä½¿ç”¨Viteä»£ç†é…ç½®

**Q: ç™»å½•åtokenæ— æ•ˆ**
A: æ£€æŸ¥åç«¯tokenæ ¼å¼å’Œå‰ç«¯å¤„ç†é€»è¾‘æ˜¯å¦åŒ¹é…

**Q: APIè¯·æ±‚404**
A: æ£€æŸ¥APIè·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®è®¤åç«¯è·¯ç”±é…ç½®

**Q: æƒé™éªŒè¯å¤±è´¥**
A: æ£€æŸ¥ç”¨æˆ·è§’è‰²é…ç½®å’Œæƒé™éªŒè¯é€»è¾‘
