# 前后端联测配置说明

## 📋 配置步骤

### 1. 配置API地址
**文件位置**: `src/config/index.js`

```javascript
// 开发环境
development: {
  // 将此处改为真实的后端API地址
  apiBaseUrl: 'http://localhost:8080', // 示例：后端运行在8080端口
  appTitle: '智能设计助手'
}
```

### 2. 启用代理配置
**文件位置**: `vite.config.js`

```javascript
server: {
  port: 5173,
  strictPort: true,
  // 取消注释以下代理配置
  proxy: {
    '/api': {
      target: 'http://localhost:8080', // 后端API地址
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '')
    }
  }
}
```

### 3. 恢复Token验证
**文件位置**: `src/utils/request.js`

```javascript
// 请求拦截器 - 取消注释以下代码
const userStore = useUserStore()
if (userStore.token) {
  config.headers['Authorization'] = `Bearer ${userStore.token}`
}

// 响应拦截器 - 删除模拟响应代码
// 删除以下代码块：
// if (error.code === 'ERR_NETWORK' || error.message.includes('Network Error')) {
//   console.log('前端测试模式：模拟API响应')
//   return Promise.resolve({...})
// }

// 401错误处理 - 取消注释以下代码
ElMessage.error('登录已过期，请重新登录')
const userStore = useUserStore()
userStore.logout()
window.location.href = '/login'
```

### 4. 恢复路由守卫
**文件位置**: `src/router/index.js`

```javascript
// 取消注释以下代码
const token = localStorage.getItem('token')
const userRole = localStorage.getItem('userRole')

// 删除测试阶段的默认值
// const token = localStorage.getItem('token') || 'test-token'
// const userRole = localStorage.getItem('userRole') || 'admin'

// 取消注释token检查代码
if (!token) {
  console.log('未登录，跳转到登录页')
  next('/login')
  return
}
```

### 5. 恢复真实登录
**文件位置**: `src/stores/user.js`

```javascript
// 取消注释真实API调用代码
const response = await loginApi(credentials)
token.value = response.token
localStorage.setItem('token', response.token)

// 删除模拟登录代码
// const mockResponse = {...}

// 取消注释真实用户信息获取
await fetchUserInfo()

// 删除模拟用户信息代码
// userInfo.value = mockResponse.userInfo
// permissions.value = mockResponse.userInfo.role === 'admin' ? ['admin'] : ['user']
```

## 🔧 验证步骤

1. **启动后端服务**
   ```bash
   # 确保后端服务运行在配置的端口上
   # 例如：http://localhost:8080
   ```

2. **启动前端服务**
   ```bash
   npm run dev
   ```

3. **测试登录功能**
   - 访问 `http://localhost:5173/login`
   - 使用真实的用户名和密码登录
   - 验证token是否正确保存

4. **测试API请求**
   - 检查浏览器开发者工具的Network面板
   - 确认API请求发送到正确的后端地址
   - 验证响应数据格式

## ⚠️ 注意事项

1. **CORS配置**: 确保后端已正确配置CORS，允许前端域名访问
2. **API格式**: 确保后端API返回格式与前端期望一致
3. **Token格式**: 确认后端返回的token格式与前端处理逻辑匹配
4. **错误处理**: 测试各种错误情况（网络错误、认证失败等）

## 🚀 快速切换

如果需要快速切换回前端测试模式：

1. 在 `src/config/index.js` 中将 `apiBaseUrl` 设为空字符串
2. 在 `vite.config.js` 中注释掉代理配置
3. 在 `src/utils/request.js` 中恢复模拟响应代码
4. 在 `src/stores/user.js` 中恢复模拟登录代码
5. 在 `src/router/index.js` 中恢复测试阶段的默认值

## 📞 常见问题

**Q: 前端请求报CORS错误**
A: 检查后端CORS配置，或使用Vite代理配置

**Q: 登录后token无效**
A: 检查后端token格式和前端处理逻辑是否匹配

**Q: API请求404**
A: 检查API路径是否正确，确认后端路由配置

**Q: 权限验证失败**
A: 检查用户角色配置和权限验证逻辑
